---
layout: post
title: Getting more out of IIS - part 1
---

I've been using IIS in its various versions for many a year now. For the most part it was a service to be used in the background,
superficially understood but not really at the front of the mind when developing software that it would host.
(That is until IIS 7 turned up, at which point "superficially understood" was replaced by "baffling me with its UI" for a little while.)

However, when I recently attended a talk on IIS by Ido Flatow at [DevWeek 2014](http://devweek.com/), I realised that there were a lot 
of features in IIS that I was mising which are readily available, easily configurable, and really, really useful.

Here are some of the ones that caught my attention.

(I've broken this down into a few separate posts since I got a bit carried away, and there's really too much to fit into a single post!)

## Advanced application pool settings

There are a few very handy things you can do with the advanced settings of an application pool to give you more control over the lifecycle and lifespan 
of each pool, and the information generated by each one.

### CPU throttling

This one's pretty straightforward. Set the ceiling on how much processing power should be given over to an application pool, and IIS will attempt to 
ensure that the pool doesn't get too processor-hungry. It's not an exact science, but it could make a big difference if one of your processes hangs 
or crashes.

### Recycling

Application pools are set to recycle every 29 hours by default. This is nice, but it won't be very helpful if the recycle time happens to be 9am 
on a Monday morning, when all of your users try to log in at once. You can override the settings around recycling to change the regular recycle time, 
or go a step further and set recycle events to occur at specific times on specific dates - allowing you to set recycling up for evenings, weekends and 
holidays.

### Process orphaning

Now we're getting to the good stuff.  If a process fails you usually don't have much log information to fall back on in order to figure out the steps 
leading up to the failure.  You can use the built-in **W3WC logs** but they're a pain in the eyes, and don't give granularity to the individual application 
pool level anyway. So...

### Rapid fail protection

Another way that processes can often fail is on startup.  If some bad code causes a process to fail in this way, IIS will helpfully attempt to restart the 
failed process immediately, causing a repeated failure/restart loop.  If you feel the need to guard against this particular scenario, it's possible to set 
up IIS to prevent an application pool from repeatedly restarting, and instead (as with the process orphaning option above) ask it to execute a command when 
this happens (such as sending an email to a helpful sysadmin).

## Compression

IIS compresses some static file types such as CSS and Javascript (but not all - for example it will not try to compress JPEGs since they're already in a  compressed format).  These compressed files are stored **somewhere under inetpub** for reuse.
It is also possible to set up IIS to perform compression of some dynamic files too.  A specific component needs to be added to enable this feature.
When you enable dynamic compression, responses created by a variety of server-side file types (for example a rendered ASPX page) are compressed before being 
sent back to the client.  This obviously has a cost in terms of CPU and memory, and the compressed responses are not cached, but can be useful if the trade-off 
between HTTP bandwidth and local server processing cost is justified.
Not all dynamic responses are compressed by default - for example, JSON files are not compressed.  However, it is possible to tweak the compression settings 
in order to include other types of response.  For example, to ensure that JSON files are included in compression, go to top-level Configuration Editor, find system.webserver/httpCompression/dynamicTypes and add the JSON mimetype there.  **EASY!**

## Caching

## URL rewriting

## Advanced logging
